I"õ<h2 id="github-action-ì„¤ì •">Github Action ì„¤ì •</h2>
<p>Github Actionì€ ì‚¬ìš©ìê°€ ì›í•˜ëŠ” íŠ¸ë¦¬ê±°ì— ë”°ë¼ ì›Œí¬í”Œë¡œìš°ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆëŠ” CI(Continuous Integration) ë„êµ¬ì…ë‹ˆë‹¤. êµ¬ê¸€ì˜ Gemini-1.5-flash ëª¨ë¸ì„ ì‚¬ìš©í•˜ì—¬ Pull Requestì‹œ ì½”ë“œ ë³€ê²½ì‚¬í•­ì— ëŒ€í•´ LLMì´ ì½”ë“œë¦¬ë·°í•  ìˆ˜ ìˆë„ë¡ ì›Œí¬í”Œë¡œìš°ë¥¼ ìƒì„±í•˜ëŠ” ê³¼ì •ì„ ì„¤ëª…í•  ê²ƒì…ë‹ˆë‹¤.</p>

<h3 id="workflowyml">workflow.yml</h3>
<p>repositoryì— <code class="language-plaintext highlighter-rouge">.github/workflows</code>ì— ì›Œí¬í”Œë¡œìš°ê°€ ì •ì˜ëœ ymlíŒŒì¼ì´ ìˆìœ¼ë©´ github actionì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">name</span><span class="pi">:</span> <span class="s">code-review</span>

<span class="na">on</span><span class="pi">:</span>
  <span class="na">pull_request</span><span class="pi">:</span>
    <span class="na">types</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">opened</span><span class="pi">,</span> <span class="nv">reopened</span><span class="pi">,</span> <span class="nv">synchronize</span><span class="pi">]</span>
  <span class="na">workflow_dispatch</span><span class="pi">:</span>

<span class="na">jobs</span><span class="pi">:</span>
  <span class="na">review</span><span class="pi">:</span>
    <span class="na">runs-on</span><span class="pi">:</span> <span class="s">ubuntu-latest</span>
    <span class="na">permissions</span><span class="pi">:</span>
      <span class="na">contents</span><span class="pi">:</span> <span class="s">read</span>
      <span class="na">pull-requests</span><span class="pi">:</span> <span class="s">write</span>
    <span class="na">steps</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Checkout Repo</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/checkout@v3</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Set up Node</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/setup-node@v3</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Install GoogleGenerativeAI</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">npm install @google/generative-ai</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Get git diff</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">git fetch origin "${{ github.event.pull_request.base.ref }}"</span>
          <span class="s">git fetch origin "${{ github.event.pull_request.head.ref }}"</span>
          <span class="s">git diff --unified=0 "origin/${{ github.event.pull_request.base.ref }}" &gt; "diff.txt"</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Run Gemini-1.5-flash</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">actions/github-script@v7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">script</span><span class="pi">:</span> <span class="pi">|</span>
            <span class="s">const fs = require("fs");</span>
            <span class="s">const diff_output = fs.readFileSync("diff.txt",'utf8');</span>
            
            <span class="s">const { GoogleGenerativeAI } = require("@google/generative-ai");</span>
            <span class="s">const genAI = new GoogleGenerativeAI("${{ secrets.GEMINI_API_KEY }}");</span>
            <span class="s">const model = genAI.getGenerativeModel({ model: "gemini-1.5-flash"});</span>
            
            <span class="s">const prompt = `You are a senior software engineer and need to perform a code review based on the results of a given git diff. Review the changed code from different perspectives and let us know if there are any changes that need to be made. If you see any code that needs to be fixed in the result of the git diff, you need to calculate the exact line number by referring to the â€œ@@ -0,0 +0,0 @@â€ part. The output format is \[{â€œpathâ€:â€œ{ filepath }â€, â€œlineâ€: { line }, â€œtextâ€: { review comment }, â€œsideâ€: â€œRIGHT"}\] format must be respected.\n&lt;git diff&gt;${diff_output}&lt;/git diff&gt;`;</span>
            <span class="s">const result = await model.generateContent(prompt);</span>
            <span class="s">const response = await result.response;</span>
            <span class="s">const text = response.text();</span>
            
            <span class="s">fs.writeFileSync('res.txt',text);</span>
            <span class="s">console.log('Save Results!')</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">output</span>
        <span class="na">id</span><span class="pi">:</span> <span class="s">store</span>
        <span class="na">run</span><span class="pi">:</span> <span class="pi">|</span>
          <span class="s">COMMENT=$(sed '/^```/d' res.txt | jq -c .)</span>
          <span class="s">echo "comment=$COMMENT" &gt;&gt; $GITHUB_OUTPUT</span>
      <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">Add Pull Request Review Comment</span>
        <span class="na">uses</span><span class="pi">:</span> <span class="s">nbaztec/add-pr-review-comment@v1.0.7</span>
        <span class="na">with</span><span class="pi">:</span>
          <span class="na">comments</span><span class="pi">:</span> <span class="s">${{ steps.store.outputs.comment }}</span>
          <span class="na">repo-token</span><span class="pi">:</span> <span class="s">${{ secrets.GITHUB_TOKEN }}</span>
          <span class="na">repo-token-user-login</span><span class="pi">:</span> <span class="s1">'</span><span class="s">github-actions[bot]'</span> <span class="c1"># The user.login for temporary GitHub tokens</span>
          <span class="na">allow-repeats</span><span class="pi">:</span> <span class="no">false</span> <span class="c1"># This is the default</span>
</code></pre></div></div>

:ET