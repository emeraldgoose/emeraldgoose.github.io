I"•&<h1 id="objective">Objective</h1>
<p>ì•ì—ì„œ êµ¬í˜„í•œ LayerNorm, MultiHeadAttention, GELUë¥¼ ì‚¬ìš©í•˜ê³  ì´ì „ì— êµ¬í˜„í•´ë‘” Linear, Dropout, Softmax í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ Transformer í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ í…ŒìŠ¤íŠ¸í•´ë´…ë‹ˆë‹¤.</p>

<p>ê°€ì¥ ë°”ê¹¥ìª½ì— ìœ„ì¹˜í•œ Transformerë¶€í„° ì‹œì‘í•´ì„œ EncoderLayer, DecoderLayer ìˆœìœ¼ë¡œ ì„¤ëª…í•˜ê³ ì í•©ë‹ˆë‹¤.</p>

<h1 id="transformer">Transformer</h1>
<p>Transformer í´ë˜ìŠ¤ì˜ êµ¬ì¡°ëŠ” TransformerEncoderì™€ TransformerDeocderë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. Transformerë¡œ ë“¤ì–´ì˜¤ëŠ” ì…ë ¥ì€ ì¸ì½”ë”ë¥¼ í†µí•´ ì¸ì½”ë”©ë˜ì–´ ë””ì½”ë”ì˜ ì…ë ¥ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/d/1gZ0C9THux083GBFOzvyd9J2nuQ2iAdPS" alt="" width="500" /></p>

<h2 id="forward">Forward</h2>
<p>Transformer í´ë˜ìŠ¤ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ TransformerEncoderì™€ TransformerDecoderì—ì„œ ì‚¬ìš©í•  encoder_layer, encoder_norm, decoder_layer, decoder_normì„ ì„ ì–¸í•©ë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/ba48acb781e5437b6585d18d57ecd83e.js"></script>

<h2 id="backward">Backward</h2>
<p>Backwardì—ì„œëŠ” Encoderì™€ Decoderì˜ backward í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•˜ê³  ë¦¬í„´ë˜ëŠ” ê¸°ìš¸ê¸°ë“¤ì„ ì €ì¥í•©ë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/a9b4402ce637590185e56919604d6efe.js"></script>

<h1 id="transformerencoder">TransformerEncoder</h1>
<p>Transformerì˜ EncoderëŠ” EncoderLayerë“¤ì´ ìŠ¤íƒë˜ì–´ ìˆëŠ” êµ¬ì¡°ë¡œ êµ¬í˜„ë©ë‹ˆë‹¤.</p>

<h2 id="forward-1">Forward</h2>
<p>Pytorchì˜ TransformerEncoder í´ë˜ìŠ¤ëŠ” ì¸ì½”ë” ë ˆì´ì–´ë¥¼ <code class="language-plaintext highlighter-rouge">num_layers</code>ë§Œí¼ ë³µì‚¬í•˜ì—¬ ModuleListë¡œ êµ¬ì„±í•©ë‹ˆë‹¤. Transformer í´ë˜ìŠ¤ì—ì„œ ì„ ì–¸ëœ EncoderLayerë¥¼ <code class="language-plaintext highlighter-rouge">_get_clone</code> í•¨ìˆ˜ì—ì„œ <code class="language-plaintext highlighter-rouge">copy.deepcopy()</code>ë¡œ ë³µì‚¬í•˜ê¸° ë•Œë¬¸ì— ìŠ¤íƒë˜ì–´ ìˆëŠ” ì¸ì½”ë” ë ˆì´ì–´ë“¤ì€ ê°™ì€ ì´ˆê¸° íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì§€ê³  ë‹¤ë¥¸ ê¸°ìš¸ê¸°ë¥¼ ê°€ì§€ê²Œ ë©ë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/c3997f35f4a3e76a6da5d697109de5ae.js"></script>

<h2 id="backward-1">Backward</h2>
<p>Forwardì—ì„œ ë°˜ë³µë¬¸ì„ í†µí•´ ìˆœì„œëŒ€ë¡œ ê³„ì‚°í•˜ê³  ìˆìœ¼ë¯€ë¡œ ê·¸ ì—­ìˆœìœ¼ë¡œ Backward í•¨ìˆ˜ë¥¼ ë¶ˆëŸ¬ ê³„ì‚°í•˜ê³  ê° ë ˆì´ì–´ì˜ ê¸°ìš¸ê¸°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/734b8145dc245a8199e3f3a271081ffe.js"></script>

<h1 id="transformerdecoder">TransformerDecoder</h1>
<p>Transformerì˜ DecoderëŠ” DecoderLayerë“¤ì´ ìŠ¤íƒë˜ì–´ ìˆëŠ” êµ¬ì¡°ë¡œ êµ¬í˜„ë©ë‹ˆë‹¤. ë‹¤ìŒ ê·¸ë¦¼ì˜ ì˜¤ë¥¸ìª½ ì²˜ëŸ¼ DecoderëŠ” Output ì„ë² ë”©ê³¼ ì¸ì½”ë”© ì •ë³´ë¥¼ ì…ë ¥ìœ¼ë¡œ ë°›ì•„ ì¶œë ¥ê°’ì„ ê³„ì‚°í•©ë‹ˆë‹¤.</p>

<h2 id="forward-2">Forward</h2>
<p>forward í•¨ìˆ˜ì˜ argumentë¡œ <code class="language-plaintext highlighter-rouge">tgt</code>ì™€ <code class="language-plaintext highlighter-rouge">memory</code>ê°€ ìˆìŠµë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">tgt</code>ëŠ” output ì„ë² ë”©ì„ ë§í•˜ê³  <code class="language-plaintext highlighter-rouge">memory</code>ëŠ” ì¸ì½”ë” ì¶œë ¥ì„ ë§í•©ë‹ˆë‹¤.</p>

<p>Encoder êµ¬í˜„ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ Transformer í´ë˜ìŠ¤ì—ì„œ ì„ ì–¸ëœ DecoderLayerë¥¼ ë³µì‚¬í•˜ì—¬ ModuleListë¡œ êµ¬ì„±í•˜ê³  ë°˜ë³µë¬¸ì„ í†µí•´ í˜¸ì¶œí•˜ì—¬ ê³„ì‚°í•©ë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/23d416bbbe0732af2d080e7c1aa4f1eb.js"></script>

<h2 id="backward-2">Backward</h2>
<p>Fowardì—ì„œ ë°˜ë³µë¬¸ì„ í†µí•´ ìˆœì„œëŒ€ë¡œ ê³„ì‚°í•˜ê³  ìˆìœ¼ë¯€ë¡œ ê·¸ ì—­ìˆœìœ¼ë¡œ Backward í•¨ìˆ˜ë¥¼ ë¶ˆëŸ¬ ê³„ì‚°í•˜ê³  ê° ë ˆì´ì–´ì˜ ê¸°ìš¸ê¸°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/52a3b5ed4af3d7a7bbb7606455d9e39c.js"></script>

<h1 id="transformerencoderlayer">TransformerEncoderLayer</h1>
<p>Transformerì˜ ì¸ì½”ë”©ì„ ë‹´ë‹¹í•˜ëŠ” ë ˆì´ì–´ì…ë‹ˆë‹¤. TransformerEncoderë¡œ ë“¤ì–´ì˜¨ ì…ë ¥ì€ EncoderLayerì˜ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬ë˜ë©° ìµœì¢… ì¶œë ¥ì€ Decoderì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>

<h2 id="forward-3">Forward</h2>
<p>ê³„ì‚° ìˆœì„œëŠ” ë“¤ì–´ì˜¨ ì…ë ¥ì´ ë¨¼ì € MultiheadAttentionì„ ê±°ì¹˜ê³  FeedForward ì—°ì‚°ì„ í†µí•´ ì¸ì½”ë”©ë©ë‹ˆë‹¤. ê° ê²°ê³¼ëŠ” Residual Connection êµ¬ì¡°ë¥¼ ì‚¬ìš©í•˜ì—¬ ì…ë ¥ê³¼ ë”í•´ì¤€ í›„ Layer Normalizationì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
<script src="https://gist.github.com/emeraldgoose/511db6e7427152cf747b55f2982e3570.js"></script></p>

<h2 id="backward-3">Backward</h2>
<p>Backward ì—°ì‚°ì€ Forwardì˜ ì—­ìˆœìœ¼ë¡œ ì§„í–‰ë˜ë©° Forwardì—ì„œ ì‚¬ìš©ëœ Residual Connectionì€ Backwardì—ì„œëŠ” upstream gradientì™€ ë”í•´ì§€ê²Œ ë©ë‹ˆë‹¤.
<script src="https://gist.github.com/emeraldgoose/5ce3f68358a1d4c2b1a0b9151981f1e7.js"></script></p>

<h1 id="transformerdecoderlayer">TransformerDecoderLayer</h1>
<p>Transformerì˜ ë””ì½”ë”©ì„ ë‹´ë‹¹í•˜ëŠ” ë ˆì´ì–´ì…ë‹ˆë‹¤. ì¸ì½”ë”ì˜ ì¶œë ¥ì„ ë””ì½”ë”ì—ì„œ ì‚¬ìš©í•˜ì—¬ output ì‹œí€€ìŠ¤ ì´í›„ì— ë‚˜ì˜¬ í† í°ì„ ì˜ˆì¸¡í•˜ê²Œ ë©ë‹ˆë‹¤.</p>

<h2 id="forward-4">Forward</h2>
<p>forwardì˜ argumentë¡œ <code class="language-plaintext highlighter-rouge">tgt</code>ì™€ <code class="language-plaintext highlighter-rouge">memory</code>ê°€ ìˆìŠµë‹ˆë‹¤. <code class="language-plaintext highlighter-rouge">tgt</code>ëŠ” output ì„ë² ë”© ì…ë ¥ì„ ë‹´ë‹¹í•˜ê³  <code class="language-plaintext highlighter-rouge">memory</code>ëŠ” ì¸ì½”ë”ì˜ ì¶œë ¥ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. EncoderLayerì™€ ë§ˆì°¬ê°€ì§€ë¡œ ê° ë‹¨ê³„ë§ˆë‹¤ Residual Connection êµ¬ì¡°ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/d55c7cf1dda2b952a0e3ac3610f2f84d.js"></script>

<h2 id="backward-4">Backward</h2>
<p>Backward ì—°ì‚°ì€ Forwardì˜ ì—­ìˆœìœ¼ë¡œ ì§„í–‰ë˜ë©° Residual Connectionì€ upstream gradientì™€ ë”í•´ì§€ê²Œ ë©ë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/be7a478bcd7b067516a81ca37e4d2239.js"></script>

<h1 id="test">Test</h1>
<h2 id="mnist-classification">MNIST Classification</h2>
<p>ì´ì „ í…ŒìŠ¤íŠ¸ì™€ ë§ˆì°¬ê°€ì§€ë¡œ MNIST 5000ì¥ê³¼ í…ŒìŠ¤íŠ¸ 1000ì¥ìœ¼ë¡œ ì‹¤í—˜í–ˆìŠµë‹ˆë‹¤. hidden_sizeëŠ” 32, learning_rateëŠ” 1e-3, 10 epochë¡œ í•™ìŠµì„ ì§„í–‰í–ˆìŠµë‹ˆë‹¤.</p>

<p>ë‹¤ìŒì€ í•™ìŠµì— ì‚¬ìš©í•œ ëª¨ë¸ì„ ì •ì˜í•œ ì½”ë“œì…ë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/b998ee81096e78ccc7694291df5f242e.js"></script>

<p>MNIST ì´ë¯¸ì§€ì— ìˆœì„œ ì •ë³´ë¥¼ ì£¼ê¸° ìœ„í•´ positional encoding ì •ë³´ë¥¼ ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  Transformerì˜ ì¶œë ¥ê°’ì´ (batch_size, 28, embed_size)ì´ë¯€ë¡œ Linear ë ˆì´ì–´ë¡œ í†µê³¼ì‹œí‚¤ê²Œ ë˜ë©´ (batch_size, 28, 10)ì´ ë˜ì–´ë²„ë¦¬ê¸° ë•Œë¬¸ì— Flatten ë ˆì´ì–´ë¥¼ í†µí•´ (batch_size, 28 * embed_size)ë¡œ ë°”ê¿”ì¤€ í›„ Linear ë ˆì´ì–´ë¥¼ í†µí•´ (batch_size, 10) í¬ê¸°ë¥¼ ê°€ì§„ logits ê°’ìœ¼ë¡œ ì¶œë ¥í•˜ë„ë¡ ëª¨ë¸ì„ êµ¬ì„±í–ˆìŠµë‹ˆë‹¤.</p>

<p>ì•„ë˜ ê·¸ë˜í”„ë“¤ì€ í•™ìŠµì‹œí‚¨ ê²°ê³¼ì…ë‹ˆë‹¤. ì™¼ìª½ ê·¸ë˜í”„ëŠ” loss, ì˜¤ë¥¸ìª½ ê·¸ë˜í”„ëŠ” accuracyë¥¼ ê¸°ë¡í•œ ê²ƒì…ë‹ˆë‹¤.</p>

<p><img src="https://lh3.googleusercontent.com/d/1epA5L2HrTdj0b9uFXM8Jn2mdtW-jI7X5" alt="" width="450" />
<img src="https://lh3.googleusercontent.com/d/1ePHIHmU0QPcUtIeOhHfGkU5EZkS0aJUM" alt="" width="450" /></p>

<p>hidden sizeê°€ í¬ì§€ ì•Šì•˜ì§€ë§Œ ì˜ í•™ìŠµë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. hidden sizeë¥¼ 256ìœ¼ë¡œ ì˜¬ë¦¬ê³  í•™ìŠµì„ ëŒë ¤ë³´ë©´ accuracyê°€ 0.95 ì´ìƒìœ¼ë¡œ ì˜¬ë¼ê°€ê¸°ë„ í•©ë‹ˆë‹¤.</p>

<h2 id="gpt">GPT</h2>
<p>ë””ì½”ë”ë§Œì„ ì´ìš©í•´ ë‹¤ìŒ í† í°ì„ ì˜ˆì¸¡í•˜ë„ë¡ ëª¨ë¸ì„ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/e780545e68eac50bcf2b21000ccdd829.js"></script>

<p>ì‚¬ìš©ëœ íŒŒë¼ë¯¸í„°ì™€ í•™ìŠµ ë¬¸ì¥ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>embed_size=256, num_heads=4, num_layers=3, learning_rate=1e-4, epochs=50
</code></pre></div></div>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sentences = [
    "The quick brown fox jumps over the lazy dog",
    "A journey of a thousand miles begins with a single step",
    "To be or not to be that is the question",
    "All that glitters is not gold but it is very valuable",
    "Knowledge is power but enthusiasm pulls the switch",
    "The only thing we have to fear is fear itself",
    "In the end we will remember not the words of our enemies",
    "Life is what happens when youâ€™re busy making other plans",
    "To succeed in life you need two things ignorance and confidence",
    "The future belongs to those who believe in the beauty of their dreams"
]
</code></pre></div></div>

<p>ë‹¤ìŒ í† í°ì„ ì˜ˆì¸¡í•  ë•ŒëŠ” ê°„ë‹¨í•˜ê²Œ êµ¬í˜„í•˜ê¸° ìœ„í•´ logitsì˜ ê°€ì¥ ë†’ì€ í™•ë¥ ì„ ê°€ì§„ í† í°ì„ ì„ íƒí–ˆê³  ë‹¤ìŒì˜ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ë¬¸ì¥ì„ ìƒì„±í•´ë´¤ìŠµë‹ˆë‹¤.</p>

<script src="https://gist.github.com/emeraldgoose/02072ada41a9bcc83c962c98693ca3f1.js"></script>

<p>ê²°ê³¼ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Input : The
Output: The future belongs to those who believe in the &lt;eos&gt;

Input : The quick
Output : The quick brown &lt;eos&gt;

Input : To
Output: To over over over over over over over over over over over over over over quick over of our of our of our jumps over our enemies &lt;eos&gt;

Input : To be
Output : To be not to be or not to be or not &lt;eos&gt;
</code></pre></div></div>

<p>ì—¬ëŸ¬ë²ˆ ìƒì„±í•  ë•Œë§ˆë‹¤ ë‹¤ë¥¸ ë¬¸ì¥ë“¤ì´ ë“±ì¥í•˜ëŠ” ê²ƒê³¼ Transformer ëª¨ë¸ íŠ¹ì§•ë‹µê²Œ í† í°ì´ ë°˜ë³µì ìœ¼ë¡œ ë“±ì¥í•˜ëŠ” ë¬¸ì œë„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ê²°ê³¼ë¥¼ í†µí•´ LLM ì‚¬ìš©ì‹œ ë³¼ ìˆ˜ ìˆëŠ” Presence penaltyë‚˜ Frequency penaltyë¥¼ ì¡°ì ˆí•˜ëŠ” ì´ìœ ë¥¼ ì•Œ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h1 id="code">Code</h1>
<p><a href="https://github.com/emeraldgoose/hcrot">https://github.com/emeraldgoose/hcrot</a></p>
:ET