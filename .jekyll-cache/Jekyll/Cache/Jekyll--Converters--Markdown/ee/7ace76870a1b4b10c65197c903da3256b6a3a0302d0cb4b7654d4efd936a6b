I"¯³<h2 id="langgraph">Langgraph</h2>
<p>LanggraphëŠ” ë…¸ë“œ(Node)ì™€ ì—£ì§€(Edge)ë¥¼ ì´ìš©í•´ ì›Œí¬í”Œë¡œìš°ì˜ íë¦„ì„ ì •ì˜í•˜ì—¬ AI Agent ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë¹Œë“œí•  ìˆ˜ ìˆëŠ” í”Œë«í¼ì…ë‹ˆë‹¤.</p>
<ul>
  <li><strong>ë…¸ë“œ(Node)</strong>: íŠ¹ì • ì‘ì—…ì„ ìˆ˜í–‰í•˜ëŠ” ë‹¨ê³„ë¥¼ ë§í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, í…ìŠ¤íŠ¸ ìš”ì•½, ê²€ìƒ‰, ì½”ë“œ ìƒì„± ë…¸ë“œ ë“±ì´ ìˆìŠµë‹ˆë‹¤.</li>
  <li><strong>ì—£ì§€(Edge)</strong>: ë…¸ë“œ ê°„ì˜ ì—°ê²°ì„ ë§í•˜ë©° ë°ì´í„° íë¦„ì„ ì •ì˜í•©ë‹ˆë‹¤. íŠ¹ì • ì¡°ê±´ì— ë”°ë¼ ë¶„ê¸°ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
  <li><strong>ìƒíƒœ(State)</strong>: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ í˜„ì¬ ìƒíƒœë¥¼ ê³µìœ í•˜ëŠ” ë°ì´í„° êµ¬ì¡°ì…ë‹ˆë‹¤.</li>
</ul>

<h3 id="reflection">Reflection</h3>
<p>Reflectionì€ Agentì˜ ê³¼ê±° í–‰ë™ì„ ë°˜ì„±í•˜ê³  ë¹„íŒí•´ì„œ Agentì˜ í’ˆì§ˆê³¼ ì„±ê³µìœ¨ì„ í–¥ìƒì‹œí‚¬ ìˆ˜ ìˆëŠ” í”„ë¡¬í”„íŒ… ì „ëµì…ë‹ˆë‹¤.</p>

<figure style="text-align:center;">
    <a>
        <img src="https://blog.langchain.dev/content/images/size/w1600/2024/02/reflection.png" alt="01" style="max-width:80%;height:auto;" />
        <figcaption>Simple Reflection Loop</figcaption>
    </a>
</figure>

<p>ê°€ì¥ ê°„ë‹¨í•œ Reflection ì˜ˆì‹œì…ë‹ˆë‹¤. generatorì™€ reflectê°€ ìˆê³  generatorì˜ ë‹µë³€ì— ëŒ€í•´ reflectê°€ ë¹„íŒì„ ì œê³µí•˜ë©´ generatorê°€ ë¹„íŒì„ ê·¼ê±°ë¡œ ì‚¼ì•„ ë‹¤ì‹œ ìƒì„±í•˜ëŠ” ë£¨í”„ì…ë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì§€ì •í•œ ë£¨í”„ íšŸìˆ˜ ë™ì•ˆ ìˆ˜í–‰ë˜ë©° ëë‚œë‹¤ë©´ ì‚¬ìš©ìì—ê²Œ ì‘ë‹µì„ ì „ë‹¬í•˜ê²Œ í•©ë‹ˆë‹¤.</p>

<h2 id="example-application">Example Application</h2>
<p>ì•„ë˜ëŠ” í…Œí¬ ë¸”ë¡œê·¸ì˜ í¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì™€ ìš”ì•½í•˜ëŠ” Agentë¥¼ êµ¬ì„±í•œ ê²ƒì…ë‹ˆë‹¤. ì´ AgentëŠ” Reflection ì „ëµì„ í†µí•´ ë‹µë³€ì„ ìˆ˜ì •í•´ì„œ ìµœì¢… ìˆ˜ì •ë³¸ì„ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.</p>

<figure class="half">
    <a href="https://1drv.ms/i/c/502fd124b305ba80/IQTg245N36tMQK6WCT_zec6DAdsPjA2J-VRiNNiiBzw0zzM?width=1024" data-lightbox="gallery" style="text-align:center;">
        <img src="https://1drv.ms/i/c/502fd124b305ba80/IQTg245N36tMQK6WCT_zec6DAdsPjA2J-VRiNNiiBzw0zzM?width=1024" alt="02" style="max-width:50%;height:auto;" />
        <figcaption>plan and execution diagram</figcaption>
    </a>
    <a href="https://1drv.ms/i/c/502fd124b305ba80/IQRYsDzRPA4CSqn6O7Xk5l_rAe4DUDQ9DIHBm5K_MxHxdt8?width=1024" data-lightbox="gallery" style="text-align:center;">
        <img src="https://1drv.ms/i/c/502fd124b305ba80/IQRYsDzRPA4CSqn6O7Xk5l_rAe4DUDQ9DIHBm5K_MxHxdt8?width=1024" alt="03" />
        <figcaption>revise diagram</figcaption>
    </a>
</figure>

<h3 id="workflow-plan-and-execution">workflow (plan and execution)</h3>

<p><strong>State</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">State</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">planning_steps</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">document</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">figures</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">tables</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">drafts</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">final_doc</span><span class="p">:</span> <span class="nb">str</span>
</code></pre></div></div>

<p><strong>get_document_node</strong>: ì´ ë…¸ë“œì—ì„œëŠ” ìš”ì•½í•˜ê³ ì í•˜ëŠ” ë¸”ë¡œê·¸ ì£¼ì†Œì— ì ‘ì†í•˜ì—¬ htmlì„ ê°€ì ¸ì˜¤ëŠ” ë…¸ë“œì…ë‹ˆë‹¤. ì´ë ‡ê²Œ ê°€ì ¸ì˜¨ htmlì€ ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì´ë¯¸ì§€, í‘œë¥¼ ì¶”ì¶œí•˜ê³  ê³„íš ë‹¨ê³„ë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">langchain_community.document_loaders</span> <span class="kn">import</span> <span class="n">AsyncHtmlLoader</span>
<span class="kn">from</span> <span class="nn">langchain_community.document_transformers</span> <span class="kn">import</span> <span class="n">MarkdownifyTransformer</span>

<span class="k">def</span> <span class="nf">get_document_node</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="n">url</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'url'</span><span class="p">)</span>
    <span class="n">loader</span> <span class="o">=</span> <span class="n">AsyncHtmlLoader</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="n">docs</span> <span class="o">=</span> <span class="n">loader</span><span class="p">.</span><span class="n">load</span><span class="p">()</span>
    
    <span class="n">md</span> <span class="o">=</span> <span class="n">MarkdownifyTransformer</span><span class="p">()</span>
    <span class="n">converted_docs</span> <span class="o">=</span> <span class="n">md</span><span class="p">.</span><span class="n">transform_documents</span><span class="p">(</span><span class="n">docs</span><span class="p">)</span>
    
    <span class="n">title</span> <span class="o">=</span> <span class="n">converted_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">metadata</span><span class="p">[</span><span class="s">'title'</span><span class="p">]</span>
    <span class="n">document</span> <span class="o">=</span> <span class="n">converted_docs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">page_content</span>

    <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">document</span><span class="o">=</span><span class="n">document</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>extract_materials</strong>: ì´ ë‹¨ê³„ì—ì„œëŠ” htmlì—ì„œ ì´ë¯¸ì§€ì™€ í‘œ í˜•ì‹ì„ ì¶”ì¶œí•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì¶”ì¶œëœ ìë£Œë“¤ì€ execution_nodeì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">extract_materials</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"##### Extract Materials #####"</span><span class="p">)</span>
    <span class="n">document</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'document'</span><span class="p">)</span>

    <span class="n">materials_prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">([(</span><span class="s">'human'</span><span class="p">,</span> <span class="n">extract_materials_instruction</span><span class="p">)])</span>
    <span class="n">chat</span> <span class="o">=</span> <span class="n">get_chat</span><span class="p">()</span>
    
    <span class="n">extracted_materials</span> <span class="o">=</span> <span class="n">materials_prompt</span> <span class="o">|</span> <span class="n">chat</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">extracted_materials</span><span class="p">.</span><span class="n">invoke</span><span class="p">({</span><span class="s">"document"</span><span class="p">:</span> <span class="n">document</span><span class="p">})</span>
    <span class="n">materials</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span>

    <span class="n">figure_materials</span> <span class="o">=</span> <span class="n">materials</span><span class="p">[</span><span class="n">materials</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'&lt;figures&gt;'</span><span class="p">)</span><span class="o">+</span><span class="mi">9</span><span class="p">:</span><span class="n">materials</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'&lt;/figures&gt;'</span><span class="p">)].</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\n\n</span><span class="s">'</span><span class="p">)</span>
    <span class="n">table_materials</span> <span class="o">=</span> <span class="n">materials</span><span class="p">[</span><span class="n">materials</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'&lt;tables&gt;'</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">:</span><span class="n">materials</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'&lt;/tables&gt;'</span><span class="p">)].</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\n\n</span><span class="s">'</span><span class="p">)</span>

    <span class="n">figures</span><span class="p">,</span> <span class="n">tables</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">figure</span> <span class="ow">in</span> <span class="n">figure_materials</span><span class="p">:</span>
        <span class="n">figures</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">figure</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">table_materials</span><span class="p">:</span>
        <span class="n">tables</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">table</span><span class="p">.</span><span class="n">strip</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="n">figures</span><span class="o">=</span><span class="n">figures</span><span class="p">,</span> <span class="n">tables</span><span class="o">=</span><span class="n">tables</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>plan_node</strong>: ì´ ë‹¨ê³„ì—ì„œëŠ” htmlë¡œë¶€í„° ì£¼ìš” í¬ì¸íŠ¸ë¥¼ ì¶”ì¶œí•˜ê³  ìš”ì•½í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì‘ì„±ëœ ê³„íšì€ execute_nodeì—ì„œ ìì„¸íˆ ì„œìˆ ë©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">plan_node</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"##### Plan ######"</span><span class="p">)</span>
    <span class="n">document</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'document'</span><span class="p">)</span>
    
    <span class="n">planner_prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">([(</span><span class="s">'human'</span><span class="p">,</span> <span class="n">plan_instruction</span><span class="p">)])</span>
    <span class="n">chat</span> <span class="o">=</span> <span class="n">get_chat</span><span class="p">()</span>

    <span class="n">planner</span> <span class="o">=</span> <span class="n">planner_prompt</span> <span class="o">|</span> <span class="n">chat</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">planner</span><span class="p">.</span><span class="n">invoke</span><span class="p">({</span><span class="s">"document"</span><span class="p">:</span> <span class="n">document</span><span class="p">})</span>
    <span class="n">plan</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">strip</span><span class="p">().</span><span class="n">replace</span><span class="p">(</span><span class="s">'</span><span class="se">\n\n</span><span class="s">'</span><span class="p">,</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>
    <span class="n">planning_steps</span> <span class="o">=</span> <span class="n">plan</span><span class="p">.</span><span class="n">split</span><span class="p">(</span><span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="n">planning_steps</span><span class="o">=</span><span class="n">planning_steps</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>execute_node</strong>: ì´ ë‹¨ê³„ëŠ” ì´ë¯¸ì§€, í‘œ ìë£Œë¥¼ ì´ìš©í•´ plan_nodeì—ì„œ ì„¸ìš´ ê³„íšë§ˆë‹¤ ì´ˆì•ˆì„ ìƒì„±í•©ë‹ˆë‹¤. ê°€ë…ì„±ì„ ìœ„í•´ êµ¬ì¡°í™”ëœ í˜•ì‹ì„ ë§Œì¡±í•  ìˆ˜ ìˆëŠ” ë§ˆí¬ë‹¤ìš´ ë¬¸ë²•ì„ ì´ìš©í•´ ì‘ì„±ë©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">execute_node</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"##### Write (execute) #####"</span><span class="p">)</span>
    <span class="n">document</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'document'</span><span class="p">)</span>
    <span class="n">planning_steps</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'planning_steps'</span><span class="p">)</span>
    <span class="n">figures</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'figures'</span><span class="p">)</span>
    <span class="n">tables</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'tables'</span><span class="p">)</span>

    <span class="n">write_prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">([(</span><span class="s">'human'</span><span class="p">,</span> <span class="n">write_instruction</span><span class="p">)])</span>
    <span class="n">text</span> <span class="o">=</span> <span class="s">""</span>
    <span class="n">drafts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">planning_steps</span><span class="p">:</span>
        <span class="n">chat</span> <span class="o">=</span> <span class="n">get_chat</span><span class="p">()</span>
        <span class="n">write_chain</span> <span class="o">=</span> <span class="n">write_prompt</span> <span class="o">|</span> <span class="n">chat</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">write_chain</span><span class="p">.</span><span class="n">invoke</span><span class="p">({</span>
            <span class="s">"document"</span><span class="p">:</span> <span class="n">document</span><span class="p">,</span>
            <span class="s">"plan"</span><span class="p">:</span> <span class="n">planning_steps</span><span class="p">,</span>
            <span class="s">"text"</span><span class="p">:</span> <span class="n">text</span><span class="p">,</span>
            <span class="s">"STEP"</span><span class="p">:</span> <span class="n">step</span><span class="p">,</span>
            <span class="s">"figures"</span><span class="p">:</span> <span class="n">figures</span><span class="p">,</span>
            <span class="s">"tables"</span><span class="p">:</span> <span class="n">tables</span>
        <span class="p">})</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">content</span>

        <span class="n">draft</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">output</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'&lt;result&gt;'</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span>

        <span class="c1"># print(f"--&gt; step:{step}")
</span>        <span class="c1"># print(f"--&gt; {draft}")
</span>
        <span class="n">drafts</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">draft</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">+=</span> <span class="n">draft</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n\n</span><span class="s">'</span>
    
    <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="n">drafts</span><span class="o">=</span><span class="n">drafts</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>revise_answers</strong>: ì´ ë‹¨ê³„ì—ì„œ ê° ì´ˆì•ˆë§ˆë‹¤ reflect-revise ê³¼ì •ì„ ê±°ì³ ì–»ì–´ì§„ ìˆ˜ì •ë³¸ì„ ëª¨ì•„ ìµœì¢…ë³¸ì„ ë§Œë“¤ì–´ ì‚¬ìš©ìì—ê²Œ ì „ë‹¬í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">get_reflect_workflow</span><span class="p">():</span>
    <span class="n">workflow</span> <span class="o">=</span> <span class="n">StateGraph</span><span class="p">(</span><span class="n">ReflectionState</span><span class="p">)</span>

    <span class="n">workflow</span><span class="p">.</span><span class="n">add_node</span><span class="p">(</span><span class="s">"reflect_node"</span><span class="p">,</span> <span class="n">reflect_node</span><span class="p">)</span>
    <span class="n">workflow</span><span class="p">.</span><span class="n">add_node</span><span class="p">(</span><span class="s">"revise_draft"</span><span class="p">,</span> <span class="n">revise_draft</span><span class="p">)</span>

    <span class="n">workflow</span><span class="p">.</span><span class="n">set_entry_point</span><span class="p">(</span><span class="s">"reflect_node"</span><span class="p">)</span>
    <span class="n">workflow</span><span class="p">.</span><span class="n">add_conditional_edges</span><span class="p">(</span>
        <span class="s">"revise_draft"</span><span class="p">,</span>
        <span class="n">should_continue</span><span class="p">,</span>
        <span class="p">{</span><span class="s">"end"</span><span class="p">:</span> <span class="n">END</span><span class="p">,</span> <span class="s">"continue"</span><span class="p">:</span> <span class="s">"reflect_node"</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">workflow</span><span class="p">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s">"reflect_node"</span><span class="p">,</span> <span class="s">"revise_draft"</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">workflow</span><span class="p">.</span><span class="nb">compile</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">revise_answers</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">State</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"##### revise #####"</span><span class="p">)</span>
    <span class="n">drafts</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"drafts"</span><span class="p">)</span>

    <span class="c1"># Not using multiprocessing
</span>    <span class="n">reflection_process</span> <span class="o">=</span> <span class="n">get_reflect_workflow</span><span class="p">()</span>
    
    <span class="n">final_doc</span> <span class="o">=</span> <span class="s">""</span>
    <span class="k">for</span> <span class="n">draft</span> <span class="ow">in</span> <span class="n">drafts</span><span class="p">:</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">reflection_process</span><span class="p">.</span><span class="n">invoke</span><span class="p">({</span><span class="s">"draft"</span><span class="p">:</span><span class="n">draft</span><span class="p">},</span> <span class="n">config</span><span class="p">)</span>
        <span class="n">final_doc</span> <span class="o">+=</span> <span class="n">output</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'revised_draft'</span><span class="p">)</span> <span class="o">+</span> <span class="s">'</span><span class="se">\n\n</span><span class="s">'</span>
    
    <span class="k">return</span> <span class="n">State</span><span class="p">(</span><span class="n">final_doc</span><span class="o">=</span><span class="n">final_doc</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="workflow-reflect">workflow (reflect)</h3>

<p><strong>State</strong></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ReflectionState</span><span class="p">(</span><span class="n">TypedDict</span><span class="p">):</span>
    <span class="n">draft</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">reflection</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">search_queries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">revised_draft</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">revision_number</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></div>

<p><strong>reflect_node</strong>: execute_nodeì—ì„œ ìƒì„±ëœ ì´ˆì•ˆì„ ë¹„íŒí•©ë‹ˆë‹¤. ì–´ë–¤ ë¶€ë¶„ì´ í¬í•¨ë˜ì§€ ì•Šì•˜ëŠ”ì§€, ë­˜ ì¶”ê°€í•´ì•¼ ë” ë‚˜ì€ ê¸€ì´ ë˜ëŠ”ì§€, ë¶ˆí•„ìš”í•œ ë¶€ë¶„ì— ëŒ€í•œ ë¹„í‰ì„ ì‘ì„±í•©ë‹ˆë‹¤. TavilySearchë¥¼ ì´ìš©í•´ ì™¸ë¶€ì—ì„œ ì •ë³´ë¥¼ ë„£ì–´ì¤„ ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Reflection</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">missing</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Critique of what is missing"</span><span class="p">)</span>
    <span class="n">advisable</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Critique of what is helpful for better writing"</span><span class="p">)</span>
    <span class="n">superfluous</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Critique of what is superfluous"</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Research</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="s">"""Provide reflection and then follow up with search queries to improve the writing."""</span>

    <span class="n">reflection</span><span class="p">:</span> <span class="n">Reflection</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"Your reflection on the initial writing for summary."</span><span class="p">)</span>
    <span class="n">search_queries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">"1-3 search queries for researching improvements to address the critique of your current writing."</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">reflect_node</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ReflectionState</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'##### Reflect #####'</span><span class="p">)</span>
    <span class="n">draft</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'draft'</span><span class="p">)</span>
    <span class="n">on_search</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">'configurable'</span><span class="p">].</span><span class="n">get</span><span class="p">(</span><span class="s">'on_search'</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>

    <span class="n">reflection</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">search_queries</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">chat</span> <span class="o">=</span> <span class="n">get_chat</span><span class="p">()</span>
        <span class="n">structured_llm</span> <span class="o">=</span> <span class="n">chat</span><span class="p">.</span><span class="n">with_structured_output</span><span class="p">(</span><span class="n">Research</span><span class="p">,</span> <span class="n">include_raw</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="n">info</span> <span class="o">=</span> <span class="n">structured_llm</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">draft</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">info</span><span class="p">[</span><span class="s">'parsed'</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">parsed_info</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s">'parsed'</span><span class="p">]</span>
            <span class="n">reflection</span> <span class="o">=</span> <span class="p">[</span><span class="n">parsed_info</span><span class="p">.</span><span class="n">reflection</span><span class="p">.</span><span class="n">missing</span><span class="p">,</span> <span class="n">parsed_info</span><span class="p">.</span><span class="n">reflection</span><span class="p">.</span><span class="n">advisable</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">on_search</span><span class="p">:</span>
                <span class="n">search_queries</span> <span class="o">=</span> <span class="n">parsed_info</span><span class="p">.</span><span class="n">search_queries</span>
            <span class="k">break</span>

    <span class="n">revision_number</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'revision_number'</span><span class="p">)</span> <span class="k">if</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'revision_number'</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">ReflectionState</span><span class="p">(</span><span class="n">revision_number</span><span class="o">=</span><span class="n">revision_number</span><span class="p">,</span> <span class="n">search_queries</span><span class="o">=</span><span class="n">search_queries</span><span class="p">,</span> <span class="n">reflection</span><span class="o">=</span><span class="n">reflection</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>revise_draft</strong>: reflect_nodeì—ì„œ ì‘ì„±ëœ ë¹„íŒì„ ê¸°ë°˜ìœ¼ë¡œ ì´ˆì•ˆì„ ìˆ˜ì •í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">revise_draft</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ReflectionState</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"##### Revise Draft #####"</span><span class="p">)</span>
    <span class="n">on_search</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">'configurable'</span><span class="p">].</span><span class="n">get</span><span class="p">(</span><span class="s">'on_search'</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">draft</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'draft'</span><span class="p">)</span>
    <span class="n">search_queries</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'search_queries'</span><span class="p">)</span>
    <span class="n">reflection</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'reflection'</span><span class="p">)</span>

    <span class="n">content</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">on_search</span><span class="p">:</span>
        <span class="n">search</span> <span class="o">=</span> <span class="n">TavilySearchResults</span><span class="p">(</span><span class="n">max_results</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">search_queries</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">search</span><span class="p">.</span><span class="n">invoke</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span>
                <span class="k">if</span> <span class="s">'content'</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
                    <span class="n">content</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'content'</span><span class="p">))</span>
    
    <span class="c1"># print("draft: ", draft)
</span>    <span class="c1"># print("reflection: ", reflection)
</span>    <span class="c1"># print("search quries: ", search_queries)
</span>    <span class="c1"># print("search results: ", content)
</span>
    <span class="n">chat</span> <span class="o">=</span> <span class="n">get_chat</span><span class="p">()</span>
    <span class="n">revise_prompt</span> <span class="o">=</span> <span class="n">ChatPromptTemplate</span><span class="p">([(</span><span class="s">'human'</span><span class="p">,</span><span class="n">revise_instruction</span><span class="p">)])</span>
    <span class="n">reflect</span> <span class="o">=</span> <span class="n">revise_prompt</span> <span class="o">|</span> <span class="n">chat</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">reflect</span><span class="p">.</span><span class="n">invoke</span><span class="p">({</span>
        <span class="s">"draft"</span><span class="p">:</span> <span class="n">draft</span><span class="p">,</span>
        <span class="s">"reflection"</span><span class="p">:</span> <span class="n">reflection</span><span class="p">,</span>
        <span class="s">"content"</span><span class="p">:</span> <span class="n">content</span><span class="p">,</span>
    <span class="p">})</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">content</span>
    <span class="n">revision_draft</span> <span class="o">=</span> <span class="n">output</span><span class="p">[</span><span class="n">output</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">'&lt;result&gt;'</span><span class="p">)</span><span class="o">+</span><span class="mi">8</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">output</span><span class="p">)</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span>
    <span class="n">revision_number</span> <span class="o">=</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">"revision_number"</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># print("revision draft: ", revision_draft)
</span>    
    <span class="k">return</span> <span class="n">ReflectionState</span><span class="p">(</span><span class="n">revised_draft</span><span class="o">=</span><span class="n">revision_draft</span><span class="p">,</span> <span class="n">revision_number</span><span class="o">=</span><span class="n">revision_number</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>should_continue</strong>: ê³„ì† ìˆ˜ì •í•´ì•¼ í•˜ëŠ”ì§€ íŒë‹¨í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ë‹¨ìˆœí•˜ê²Œ ìˆ˜ì • íšŸìˆ˜ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ì—¬ ê¸°ì¤€ì„ ë„˜ì–´ê°€ë©´ ENDë¡œ í–¥í•˜ê²Œ í•©ë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">should_continue</span><span class="p">(</span><span class="n">state</span><span class="p">:</span> <span class="n">ReflectionState</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"##### should continue #####"</span><span class="p">)</span>
    <span class="n">max_revision</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s">'configurable'</span><span class="p">].</span><span class="n">get</span><span class="p">(</span><span class="s">"max_revision"</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="c1"># print(f"revision: {state.get('revision_number',0)} / {max_revision}")
</span>    
    <span class="k">if</span> <span class="n">state</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'revision_number'</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_revision</span><span class="p">:</span>
        <span class="k">return</span> <span class="s">"end"</span>
    <span class="k">return</span> <span class="s">"continue"</span>
</code></pre></div></div>

<h3 id="run">Run</h3>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">final_state</span> <span class="o">=</span> <span class="n">graph</span><span class="p">.</span><span class="n">invoke</span><span class="p">({</span>
    <span class="s">"url"</span><span class="p">:</span><span class="s">""</span><span class="p">},</span> 
    <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s">'max_revision'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">'on_search'</span><span class="p">:</span> <span class="bp">False</span><span class="p">}</span>
    <span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'final_draft.md'</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">final_state</span><span class="p">[</span><span class="s">'final_doc'</span><span class="p">])</span>
</code></pre></div></div>

<p>ì´ Agentë¥¼ ì‹¤ì œë¡œ ë™ì‘í•˜ê²Œ ë˜ë©´ ì•½ 2~3ë¶„ì •ë„ ì‹œê°„ì´ ê±¸ë¦¬ê²Œ ë©ë‹ˆë‹¤. ì‹œê°„ì„ ë‹¨ì¶•í•˜ë ¤ë©´ reflect workflowë¥¼ multiprocessing ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ìš©í•´ ë³‘ë ¬ì²˜ë¦¬í•˜ë„ë¡ êµ¬ì„±í•˜ë©´ ë¹ ë¥´ê²Œ ì‹œê°„ì„ ë‹¨ì¶•ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<h2 id="ë‹¨ìˆœ-ìš”ì•½-ë²ˆì—­ê³¼-agent-ê²°ê³¼ì˜-ë¹„êµ">ë‹¨ìˆœ ìš”ì•½, ë²ˆì—­ê³¼ Agent ê²°ê³¼ì˜ ë¹„êµ</h2>
<p>ê°™ì€ ì›ë¬¸ì„ ë²ˆì—­, Geminië¡œ ë‹¨ìˆœ ìš”ì•½ ê·¸ë¦¬ê³  Reflection Agentì˜ ìš”ì•½ê²°ê³¼ë¥¼ ë¹„êµí•´ë³´ê² ìŠµë‹ˆë‹¤.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># ë²ˆì—­
ì´ëŸ¬í•œ í‚¤ì›Œë“œë“¤ ì¤‘ì—ì„œ ë§ˆì§€ë§‰ ì„¸íŠ¸ë§Œì´ ì‚¬ìš©ì ì˜ë„ë¥¼ ì •í™•íˆ ì¼ì¹˜ì‹œí‚µë‹ˆë‹¤. 
í•˜ì§€ë§Œ ì„ í˜¸ë„ëŠ” ë‹¤ì–‘í•œ ì†ì„±ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ì˜ˆë¥¼ ë“¤ì–´, ì†Œë¹„ìëŠ” ëª¨ë“  ë¹„ê±´ ìƒŒë“œìœ„ì¹˜ë¥¼ ëŒ€ì²´ ì˜µì…˜ìœ¼ë¡œ ê³ ë ¤í•  ìˆ˜ ìˆì§€ë§Œ, ë¹„ê±´ì´ ì•„ë‹Œ ë‹­ê³ ê¸° ìƒŒë“œìœ„ì¹˜ëŠ” ê±°ë¶€í•  ê²ƒì…ë‹ˆë‹¤. 
ì‹ì´ ì œí•œì€ ë‹¨ë°±ì§ˆ ì„ íƒê³¼ ê°™ì€ ë‹¤ë¥¸ ì†ì„±ë³´ë‹¤ ìš°ì„ í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤. 
ì‚¬ìš©ìì—ê²Œ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ê²°ê³¼ë§Œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ì—¬ëŸ¬ ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
DoorDashì—ì„œëŠ” ìœ ì—°í•œ í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œì´ ìš°ë¦¬ì˜ ìš”êµ¬ë¥¼ ê°€ì¥ ì˜ ì¶©ì¡±í•œë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. 
í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ì‹œìŠ¤í…œê³¼ ê°•ë ¥í•œ ë¬¸ì„œ ë° í‚¤ì›Œë“œ ì´í•´ë¥¼ ê²°í•©í•˜ì—¬ ë¹„ê±´ í•­ëª©ë§Œ ê²€ìƒ‰ë˜ë„ë¡ í•˜ëŠ” ê²ƒê³¼ ê°™ì€ ê·œì¹™ì„ íš¨ê³¼ì ìœ¼ë¡œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ì—¬ê¸°ì„œëŠ” ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì„ ì‚¬ìš©í•˜ì—¬ ê²€ìƒ‰ ì‹œìŠ¤í…œì„ ê°œì„ í•˜ê³  ì†Œë¹„ìì—ê²Œ ë” ì •í™•í•œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì œê³µí•œ ë°©ë²•ì„ ìì„¸íˆ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

# ìš”ì•½
ì´ ì¤‘ ë§ˆì§€ë§‰ ê²°ê³¼ë§Œ ì‚¬ìš©ìì˜ ì˜ë„ì™€ ì •í™•íˆ ì¼ì¹˜í•©ë‹ˆë‹¤. 
í•˜ì§€ë§Œ ì‚¬ìš©ìì˜ ì„ í˜¸ë„ëŠ” ì†ì„±ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ì˜ˆë¥¼ ë“¤ì–´, ì†Œë¹„ìëŠ” ë¹„ê±´ ìƒŒë“œìœ„ì¹˜ë¥¼ ëŒ€ì²´ ì˜µì…˜ìœ¼ë¡œ ê³ ë ¤í•  ìˆ˜ ìˆì§€ë§Œ, ë¹„ê±´ì´ ì•„ë‹Œ ì¹˜í‚¨ ìƒŒë“œìœ„ì¹˜ëŠ” ê±°ë¶€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ì‹ì´ ì œí•œì€ ë‹¨ë°±ì§ˆ ì„ íƒê³¼ ê°™ì€ ë‹¤ë¥¸ ì†ì„±ë³´ë‹¤ ìš°ì„ í•˜ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.

DoorDashëŠ” ìœ ì—°í•œ í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œì´ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•  ê°€ëŠ¥ì„±ì´ ê°€ì¥ ë†’ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. 
í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ì‹œìŠ¤í…œê³¼ ê°•ë ¥í•œ ë¬¸ì„œ ë° í‚¤ì›Œë“œ ì´í•´ë¥¼ ê²°í•©í•˜ì—¬ ë¹„ê±´ í•­ëª©ë§Œ ê²€ìƒ‰ë˜ë„ë¡ í•˜ëŠ” ê·œì¹™ì„ íš¨ê³¼ì ìœ¼ë¡œ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ë³¸ë¬¸ì—ì„œëŠ” DoorDashê°€ ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì„ í™œìš©í•˜ì—¬ ê²€ìƒ‰ ì‹œìŠ¤í…œì„ ê°œì„ í•˜ê³  ì†Œë¹„ìì—ê²Œ ë”ìš± ì •í™•í•œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì œê³µí•˜ëŠ” ë°©ë²•ì„ ìì„¸íˆ ì„¤ëª…í•©ë‹ˆë‹¤.

# Reflection Agent
reflection:  [
    'LLMì´ ë¬¸ì„œ ë° í‚¤ì›Œë“œë¥¼ ì´í•´í•˜ëŠ” ë° ì–´ë–»ê²Œ ì‚¬ìš©ë˜ëŠ”ì§€ì— ëŒ€í•œ ì„¤ëª…ì´ ë¶€ì¡±í•©ë‹ˆë‹¤. \
    LLMì˜ ì—­í• ê³¼ ì‘ë™ ë°©ì‹ì— ëŒ€í•œ ìì„¸í•œ ì„¤ëª…ì´ í•„ìš”í•©ë‹ˆë‹¤. \
    ë˜í•œ, ê²€ìƒ‰ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ì„ í‰ê°€í•˜ëŠ” ë° ì‚¬ìš©ë˜ëŠ” ì§€í‘œì— ëŒ€í•œ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.', 
    
    "ë” êµ¬ì²´ì ì¸ ì˜ˆì‹œë¥¼ ë“¤ì–´ì£¼ì„¸ìš”. \
    ì˜ˆë¥¼ ë“¤ì–´, LLMì´ í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ì‹œìŠ¤í…œê³¼ ì–´ë–»ê²Œ ê²°í•©ë˜ì–´ ì‘ë™í•˜ëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”. \
    ë˜í•œ, 'ë¹„ê±´' í•„í„°ë§ ê·œì¹™ ì™¸ì— ì–´ë–¤ ê·œì¹™ë“¤ì´ ì ìš©ë  ìˆ˜ ìˆëŠ”ì§€ ì˜ˆì‹œë¥¼ ë“¤ì–´ì£¼ì‹œë©´ ì´í•´ë„ë¥¼ ë†’ì´ëŠ” ë° ë„ì›€ì´ ë  ê²ƒì…ë‹ˆë‹¤."
]
ì´ ëª©ë¡ì—ì„œ ì‚¬ìš©ì ì˜ë„ì™€ ê°€ì¥ ì •í™•íˆ ì¼ì¹˜í•˜ëŠ” í•­ëª©ì€ ë§ˆì§€ë§‰ "ë¹„ê±´ ì¹˜í‚¨ ìƒŒë“œìœ„ì¹˜"ë¿ì…ë‹ˆë‹¤. 
ì‚¬ìš©ì ì„ í˜¸ë„ëŠ” ì†ì„±ì— ë”°ë¼ ìš°ì„ ìˆœìœ„ê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆëŠ”ë°, ì˜ˆë¥¼ ë“¤ì–´ ì‹ì´ ì œí•œì€ ë‹¨ë°±ì§ˆ ì„ íƒê³¼ ê°™ì€ ë‹¤ë¥¸ ì†ì„±ë³´ë‹¤ ë” ì¤‘ìš”í•˜ê²Œ ì—¬ê²¨ì§‘ë‹ˆë‹¤. 
ë”°ë¼ì„œ, ì‚¬ìš©ìì—ê²Œ ê°€ì¥ ê´€ë ¨ì„±ì´ ë†’ì€ ê²°ê³¼ë§Œì„ í‘œì‹œí•˜ëŠ” ê²ƒì€ ì¤‘ìš”í•œ ê³¼ì œì…ë‹ˆë‹¤. 
DoorDashëŠ” ìœ ì—°í•œ í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œì´ ì´ëŸ¬í•œ ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ” ë° ê°€ì¥ ì í•©í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

DoorDashëŠ” í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ì‹œìŠ¤í…œê³¼ ê°•ë ¥í•œ ë¬¸ì„œ ë° í‚¤ì›Œë“œ ì´í•´ ëŠ¥ë ¥ì„ ê²°í•©í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ë”ìš± ì •í™•í•œ ê²€ìƒ‰ ê²°ê³¼ë¥¼ ì œê³µí•˜ê³ ì ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì„ ì ê·¹ì ìœ¼ë¡œ í™œìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤. 
LLMì€ í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ì‹œìŠ¤í…œì˜ ì•½ì ì„ ë³´ì™„í•˜ê³ , ê²€ìƒ‰ì–´ì˜ ì˜ë¯¸ë¥¼ ë” ê¹Šì´ ì´í•´í•˜ì—¬ ì‚¬ìš©ì ì˜ë„ì— ë¶€í•©í•˜ëŠ” ê²°ê³¼ë¥¼ ì œê³µí•˜ëŠ” ë° í•µì‹¬ì ì¸ ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

êµ¬ì²´ì ìœ¼ë¡œ, LLMì€ ë‹¤ìŒê³¼ ê°™ì€ ë°©ì‹ìœ¼ë¡œ í™œìš©ë©ë‹ˆë‹¤. 
ì²«ì§¸, LLMì€ ê²€ìƒ‰ì–´ì™€ ìƒí’ˆ ì„¤ëª…ì„ ë¶„ì„í•˜ì—¬ í•µì‹¬ ì†ì„±ë“¤ì„ ì¶”ì¶œí•©ë‹ˆë‹¤. 
ì˜ˆë¥¼ ë“¤ì–´, "ê¸€ë£¨í… í”„ë¦¬ í”¼ì"ë¼ëŠ” ê²€ìƒ‰ì–´ì—ì„œ "ê¸€ë£¨í… í”„ë¦¬"ë¼ëŠ” ì‹ì´ ì œí•œ ì†ì„±ê³¼ "í”¼ì"ë¼ëŠ” ìƒí’ˆ ì¢…ë¥˜ ì†ì„±ì„ ì¶”ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ë‘˜ì§¸, LLMì€ ì¶”ì¶œëœ ì†ì„±ë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ í•„í„°ë§ ê·œì¹™ì„ ì ìš©í•©ë‹ˆë‹¤. 
ì˜ˆë¥¼ ë“¤ì–´, ìœ„ì—ì„œ ì–¸ê¸‰í•œ "ë¹„ê±´" í•„í„°ë§ ê·œì¹™ ì™¸ì—ë„ "ë§¤ìš´ë§›" í•„í„°ë§ ê·œì¹™, "ì•Œë ˆë¥´ê¸° ìœ ë°œ ë¬¼ì§ˆ ì œì™¸" ê·œì¹™ ë“±ì„ ì ìš©í•˜ì—¬ ì‚¬ìš©ìì˜ íŠ¹ì • ìš”êµ¬ ì‚¬í•­ì„ ì¶©ì¡±í•˜ëŠ” ê²°ê³¼ë¥¼ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 
ì…‹ì§¸, LLMì€ ìƒí’ˆ ì„¤ëª…ì˜ ì˜ë¯¸ë¥¼ ë¶„ì„í•˜ì—¬ í‚¤ì›Œë“œ ê¸°ë°˜ ê²€ìƒ‰ ì‹œìŠ¤í…œì´ ë†“ì¹  ìˆ˜ ìˆëŠ” ê´€ë ¨ ìƒí’ˆì„ ì°¾ì•„ëƒ…ë‹ˆë‹¤. 
ì˜ˆë¥¼ ë“¤ì–´, "ìˆ˜ì œ ë²„ê±°"ë¥¼ ê²€ìƒ‰í–ˆì„ ë•Œ, "ì¥ì¸ì´ ë§Œë“  íŒ¨í‹°ë¥¼ ì‚¬ìš©í•œ í”„ë¦¬ë¯¸ì—„ ë²„ê±°"ì™€ ê°™ì´ ìœ ì‚¬í•œ ì˜ë¯¸ë¥¼ ê°€ì§„ ìƒí’ˆë„ ê²€ìƒ‰ ê²°ê³¼ì— í¬í•¨ë  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤.

DoorDashëŠ” ê²€ìƒ‰ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ì„ í‰ê°€í•˜ê¸° ìœ„í•´ ë‹¤ì–‘í•œ ì§€í‘œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. 
ì˜ˆë¥¼ ë“¤ì–´, í´ë¦­ë¥ (CTR), ê²€ìƒ‰ ê²°ê³¼ì˜ ì „í™˜ìœ¨, ì‚¬ìš©ì ë§Œì¡±ë„ ì¡°ì‚¬ ë“±ì„ í†µí•´ ê²€ìƒ‰ ê²°ê³¼ì˜ ê´€ë ¨ì„±ê³¼ ì •í™•ì„±ì„ ì¸¡ì •í•©ë‹ˆë‹¤. 
ë˜í•œ, AB í…ŒìŠ¤íŠ¸ë¥¼ í†µí•´ LLM ê¸°ë°˜ ì‹œìŠ¤í…œì˜ ì„±ëŠ¥ì„ ê¸°ì¡´ ì‹œìŠ¤í…œê³¼ ë¹„êµí•˜ì—¬ ê°œì„  íš¨ê³¼ë¥¼ ì§€ì†ì ìœ¼ë¡œ ê²€ì¦í•˜ê³  ìˆìŠµë‹ˆë‹¤. 
ì´ëŸ¬í•œ ë…¸ë ¥ì„ í†µí•´ DoorDashëŠ” ì‚¬ìš©ìì—ê²Œ ë”ìš± ë§Œì¡±ìŠ¤ëŸ¬ìš´ ê²€ìƒ‰ ê²½í—˜ì„ ì œê³µí•˜ê³ ì ëŠì„ì—†ì´ ë…¸ë ¥í•˜ê³  ìˆìŠµë‹ˆë‹¤.
</code></pre></div></div>

<p>ë²ˆì—­, ìš”ì•½ê³¼ ë‹¬ë¦¬ Reflection Agentì˜ êµ¬ì„± ë°©ì‹ì´ ë‹¤ë¥¸ ê²ƒì„ ë³¼ ìˆ˜ ìˆëŠ”ë° LLMì˜ ë‹µë³€ì— ëŒ€í•´ ë” ë‚˜ì€ ë‹µë³€ì„ ìœ„í•œ ë¹„íŒì„ ì œê³µí•˜ì—¬ ë¹„íŒì„ ê·¼ê±°ë¡œí•œ ë‹µë³€ì„ ì¬ìƒì„±í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.</p>

<p>ê°œì¸ì ìœ¼ë¡œ ìš”ì•½ íƒœìŠ¤í¬ëŠ” ì™¸ë¶€ ê²€ìƒ‰ì„ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ë‚˜ì€ ê²°ê³¼ë¬¼ì„ ë³´ì—¬ì£¼ëŠ” ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ ì™¸ë¶€ ì •ë³´ê°€ ê³„ì† ì£¼ì…ë˜ë©´ ê¸€ì´ ë„ˆë¬´ ê¸¸ì–´ì§€ëŠ” ê²½ìš°ê°€ ë§ì´ ë°œìƒí–ˆìŠµë‹ˆë‹¤. 
ë¬´ì–¸ê°€ ì„¤ëª…ì´ í•„ìš”í•œ ê²½ìš°(ì˜ˆë¥¼ ë“¤ë©´, â€œLanggraphì— ëŒ€í•´ ì„¤ëª…í•´ì¤˜â€)ì— ê²€ìƒ‰ì´ë¼ëŠ” ë„êµ¬ê°€ ìœ ìš©í•˜ë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤.</p>

<h2 id="code">Code</h2>
<ul>
  <li><a href=""></a></li>
</ul>

<h2 id="reference">Reference</h2>
<ul>
  <li><a href="https://blog.langchain.dev/reflection-agents/">Reflection Agents</a></li>
  <li><a href="https://github.com/kyopark2014/writing-agent/blob/main/README.md">Writing Agent</a></li>
</ul>
:ET