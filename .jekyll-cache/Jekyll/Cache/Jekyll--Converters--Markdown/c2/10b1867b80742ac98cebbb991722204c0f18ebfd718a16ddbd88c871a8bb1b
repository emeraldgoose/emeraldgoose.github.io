I"ó<h2 id="v1-ì´ì „-structured-output">v1 ì´ì „ Structured Output</h2>
<p>Langchainì´ ìµœê·¼ v1.0ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ë©´ì„œ ê¸°ì¡´ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§ˆì´ê·¸ë ˆì´ì…˜í•´ì•¼ í•˜ëŠ” ìƒí™©ì— ë†“ì˜€ìŠµë‹ˆë‹¤.</p>

<p>ì—…ë°ì´íŠ¸ ì´ì „ Langchain ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„  ì•„ë˜ ì½”ë“œì²˜ëŸ¼ ResponseSchemaë¥¼ ì •ì˜í•˜ì—¬ Promptì— í†µí•©í•˜ì—¬ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">langchain.output_parsers</span> <span class="kn">import</span> <span class="n">StructuredOutputParser</span><span class="p">,</span> <span class="n">ResponseSchema</span>

<span class="n">response_schemas</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ResponseSchema</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s">"answer"</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s">"Answer"</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s">"string"</span>
    <span class="p">),</span>
    <span class="n">ResponseSchema</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s">"reason"</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s">"Reason"</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s">"string"</span>
    <span class="p">),</span>
<span class="p">]</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">StructuredOutputParser</span><span class="p">.</span><span class="n">from_response_schemas</span><span class="p">(</span><span class="n">response_schemas</span><span class="p">)</span>

<span class="n">chain</span> <span class="o">=</span> <span class="n">prompt</span> <span class="o">|</span> <span class="n">llm</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">chain</span><span class="p">.</span><span class="n">invoke</span><span class="p">({</span>
    <span class="s">"question"</span><span class="p">:</span> <span class="n">question</span><span class="p">,</span>
    <span class="s">"format_instruction"</span><span class="p">:</span> <span class="n">parser</span><span class="p">.</span><span class="n">get_format_instructions</span><span class="p">()</span>
<span class="p">})</span>

<span class="n">content</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="n">content</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s">'text'</span><span class="p">]</span>
<span class="n">parsed_content</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="v1-ì´í›„-structured-output">v1 ì´í›„ Structured Output</h2>
<p>ìµœì‹  Langchainì—ì„  Pydantic BaseModelì„ ì´ìš©í•´ í‘œì¤€í™”ëœ í˜•íƒœë¡œë§Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">langchain.agents</span> <span class="kn">import</span> <span class="n">create_agent</span>
<span class="kn">from</span> <span class="nn">langchain.agents.structured_output</span> <span class="kn">import</span> <span class="n">ToolStrategy</span><span class="p">,</span> <span class="n">ProviderStrategy</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="k">class</span> <span class="nc">OutputSchema</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">summary</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">sentiment</span><span class="p">:</span> <span class="nb">str</span>

<span class="c1"># Using ToolStrategy
</span><span class="n">agent</span> <span class="o">=</span> <span class="n">create_agent</span><span class="p">(</span>
    <span class="n">model</span><span class="o">=</span><span class="s">"gpt-4o-mini"</span><span class="p">,</span>
    <span class="n">tools</span><span class="o">=</span><span class="n">tools</span><span class="p">,</span>
    <span class="c1"># explicitly using tool strategy
</span>    <span class="n">response_format</span><span class="o">=</span><span class="n">ToolStrategy</span><span class="p">(</span><span class="n">OutputSchema</span><span class="p">)</span>  
<span class="p">)</span>
</code></pre></div></div>

<h2 id="gpt-ossì˜-êµ¬ì¡°í™”ëœ-ì¶œë ¥-ë¬¸ì œ">gpt-ossì˜ êµ¬ì¡°í™”ëœ ì¶œë ¥ ë¬¸ì œ</h2>
<p>ìœ„ì˜ ì˜ˆì‹œì²˜ëŸ¼ response_formatì„ êµ¬ì„±í•˜ë©´ ëª¨ë¸ì˜ ì¶œë ¥ì„ ì œì–´í•  ìˆ˜ ìˆì–´ í¸ë¦¬í•œ ì ì´ ìˆì—ˆì§€ë§Œ gpt-ossì˜ ê²½ìš° ì œëŒ€ë¡œ ì ìš©ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>

<p>ì˜¤íˆë ¤ ì•„ë˜ì™€ ê°™ì€ ì—ëŸ¬ê°€ ë°œìƒí•˜ì—¬ ì œëŒ€ë¡œ ì¶œë ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BadRequestError: Error code: 400 - {'error_code': 'BAD_REQUEST', 'message': 'Model output is not in expected format, adjust parameters or prompt and try again.\n'}
</code></pre></div></div>

<p>ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ langchainì—ì„œ ì œê³µí•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ìŠ¤í‚¤ë§ˆë¥¼ ì§ì ‘ ì‘ì„±í•˜ì—¬ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Field</span>

<span class="k">class</span> <span class="nc">ResponseFormat</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">answer</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s">"Answer for the question"</span><span class="p">)</span>
    <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="s">"Reason for the answer"</span><span class="p">)</span>

<span class="n">response_format</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"type"</span><span class="p">:</span> <span class="s">"json_schema"</span><span class="p">,</span>
    <span class="s">"json_schema"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"strict"</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="s">"name"</span><span class="p">:</span> <span class="n">ResponseFormat</span><span class="p">.</span><span class="n">__name__</span><span class="p">,</span>
        <span class="s">"schema"</span><span class="p">:</span> <span class="n">ResponseFormat</span><span class="p">.</span><span class="n">model_json_schema</span><span class="p">(),</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="n">llm</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">response_format</span><span class="o">=</span><span class="n">response_format</span><span class="p">).</span><span class="n">invoke</span><span class="p">(</span><span class="s">"hello?"</span><span class="p">)</span>
</code></pre></div></div>
:ET